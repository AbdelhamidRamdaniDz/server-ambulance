<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>إضافة طاقم طبي</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <style>
        body { font-family: 'Cairo', sans-serif; background-color: #f8f9fa; margin: 0; padding: 20px; }
        .container { max-width: 700px; margin: 20px auto; }
        .header { text-align: center; margin-bottom: 40px; }
        .header h1 { font-size: 2.5rem; color: #343a40; }
        .card { background: #fff; border-radius: 12px; padding: 30px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
        .card-title { font-size: 1.5rem; font-weight: 700; color: #1976d2; border-bottom: 1px solid #e9ecef; padding-bottom: 15px; margin-bottom: 25px; }
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 10px; font-weight: 600; color: #495057; }
        select { width: 100%; padding: 12px; border: 1px solid #ced4da; border-radius: 8px; font-family: 'Cairo', sans-serif; background-color: #fff; }
        button { padding: 12px 30px; background: linear-gradient(135deg, #1976d2, #2196F3); color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: 700; transition: all 0.3s; }
        button:hover { transform: translateY(-2px); box-shadow: 0 4px 15px rgba(33, 150, 243, 0.4); }
        .back-link { display: inline-block; margin-top: 30px; color: #007bff; text-decoration: none; font-weight: 600; }
        .error-message { background-color: #f8d7da; color: #721c24; padding: 15px; border: 1px solid #f5c6cb; border-radius: 5px; margin-bottom: 20px; text-align: center; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>إضافة طاقم طبي لقسم</h1>
        </div>

        <div class="card">
            <h2 class="card-title">توزيع الأطباء</h2>
             <% if (locals.error) { %>
                <p class="error-message"><%= error %></p>
             <% } %>
            <form id="addStaffForm" method="POST">
                <div class="form-group">
                    <label for="departmentId">اختر القسم</label>
                    <select id="departmentId" name="departmentId" required onchange="updateFormAction(this.value)">
                        <option value="">-- يرجى اختيار قسم --</option>
                        <% departments.forEach(dept => { %>
                            <option value="<%= dept._id %>"><%= dept.name %></option>
                        <% }); %>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="doctorId">اختر الطبيب</label>
                    <select id="doctorId" name="doctorId" required>
                         <option value="">-- يرجى اختيار طبيب --</option>
                        <% doctors.forEach(doc => { %>
                            <option value="<%= doc._id %>"><%= doc.firstName %> <%= doc.lastName %></option>
                        <% }); %>
                    </select>
                </div>

                <div class="form-group">
                    <label for="roleInDepartment">دور الطبيب في القسم</label>
                    <select id="roleInDepartment" name="roleInDepartment" required>
                        <option value="مناوب">مناوب</option>
                        <option value="رئيس قسم">رئيس قسم</option>
                        <option value="تحت الطلب">تحت الطلب</option>
                        <option value="أخصائي">أخصائي</option>
                    </select>
                </div>

                <button type="submit">إضافة إلى الطاقم</button>
            </form>
        </div>

        <a href="/hospital-panel/dashboard" class="back-link">العودة إلى لوحة التحكم</a>
    </div>

    <script>
        function updateFormAction(departmentId) {
            const form = document.getElementById('addStaffForm');
            if (departmentId) {
                // تحديث رابط الإرسال ديناميكيًا بناءً على القسم المختار
                form.action = `/api/hospitals/departments/${departmentId}/staff`;
            } else {
                form.action = ""; // منع الإرسال إذا لم يتم اختيار قسم
            }
        }
    </script>
</body>
</html>
